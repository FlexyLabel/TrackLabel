<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Track Label Pro - Vertical</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --bg: #0b0e11; --sidebar: #15191d; --surface: #1e2329;
            --orange: #ff7a00; --green: #00ff88; --text: #f0f0f0; --border: #282e35;
        }
        
        * { box-sizing: border-box; outline: none; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; }

        /* SEGURIDAD INICIAL */
        .master-overlay { position: fixed; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 20000; }
        .login-overlay { position: fixed; inset: 0; background: radial-gradient(circle, #1e2329 0%, #0b0e11 100%); display: flex; align-items: center; justify-content: center; z-index: 10000; padding: 20px; }
        .login-box { background: var(--surface); padding: 40px; border-radius: 35px; text-align: center; width: 100%; max-width: 440px; border: 1px solid #333; }
        
        .user-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 30px 0; }
        .user-item { background: #15191d; padding: 15px; border-radius: 20px; border: 1px solid #222; cursor: pointer; transition: 0.3s; font-size: 14px; }
        .user-item.selected { border-color: var(--orange); background: #2a3139; }

        /* LAYOUT PRINCIPAL */
        .app-container { display: flex; flex-direction: column; min-height: 100vh; }
        
        .top-bar { background: var(--sidebar); padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; sticky; top: 0; z-index: 100; }
        .content-area { flex: 1; padding: 15px; max-width: 800px; margin: 0 auto; width: 100%; }

        /* KANBAN VERTICAL (UNA ENCIMA DE OTRA) */
        .kanban-board { display: flex; flex-direction: column; gap: 30px; }
        .machine-col { background: #15191d; padding: 20px; border-radius: 25px; border: 1px solid var(--border); }
        .col-header { border-bottom: 1px solid #222; margin-bottom: 15px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .col-header h3 { margin: 0; color: var(--orange); font-size: 18px; letter-spacing: 1px; }
        .badge { background: #000; color: #fff; padding: 5px 12px; border-radius: 10px; font-size: 12px; }

        /* TARJETAS */
        .drag-zone { min-height: 80px; }
        .job-card { background: var(--surface); padding: 20px; border-radius: 20px; margin-bottom: 15px; border-left: 6px solid var(--orange); cursor: pointer; position: relative; }
        .job-card strong { font-size: 18px; display: block; margin-bottom: 5px; }
        .job-card small { color: #888; font-size: 14px; }

        /* MODALES */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 15000; padding: 20px; overflow-y: auto; }
        .modal-content { background: var(--surface); margin: 5% auto; padding: 30px; border-radius: 30px; width: 100%; max-width: 500px; border: 1px solid #333; }
        
        input, select { width: 100%; background: #000; border: 1px solid #333; padding: 15px; color: white; border-radius: 12px; margin-bottom: 20px; font-size: 16px; }
        .btn-action { width: 100%; padding: 20px; background: var(--orange); border: none; border-radius: 15px; color: white; font-weight: bold; cursor: pointer; font-size: 16px; }

    </style>
</head>
<body>

<div id="master-lock" class="master-overlay">
    <div class="login-box">
        <h2 style="color:var(--orange)">TRACK LABEL</h2>
        <input type="password" id="pass-web" placeholder="Password: TrackLabel#" style="text-align:center;">
        <button class="btn-action" onclick="unlockWeb()">ENTRAR</button>
    </div>
</div>

<div id="login-screen" class="login-overlay" style="display:none">
    <div class="login-box">
        <h3>SISTEMA DE PLANTA</h3>
        <div class="user-grid">
            <div class="user-item" onclick="selectUser('Isa', this)">Isa</div>
            <div class="user-item" onclick="selectUser('Jaume', this)">Jaume</div>
            <div class="user-item" onclick="selectUser('Ivan', this)">Ivan</div>
            <div class="user-item" onclick="selectUser('Anna', this)">Anna</div>
            <div class="user-item" onclick="selectUser('Toni', this)">Toni</div>
        </div>
        <input type="password" id="user-pin" placeholder="PIN Operario" style="text-align:center;">
        <button class="btn-action" onclick="loginApp()">ACCEDER</button>
    </div>
</div>

<div id="main-app" class="app-container" style="display:none">
    <header class="top-bar">
        <div>
            <span id="welcome-text" style="font-weight:bold; color:var(--orange)">Usuario</span>
        </div>
        <button onclick="openModal()" style="background:var(--orange); border:none; padding:10px 20px; border-radius:10px; color:white; font-weight:bold; cursor:pointer;">+ NUEVO</button>
    </header>

    <main class="content-area">
        <div class="kanban-board">
            <div class="machine-col">
                <div class="col-header"><h3>FLEXO</h3> <span id="badge-flexo" class="badge">0</span></div>
                <div id="list-flexo" class="drag-zone"></div>
            </div>
            <div class="machine-col">
                <div class="col-header"><h3>DIGITAL</h3> <span id="badge-digital" class="badge">0</span></div>
                <div id="list-digital" class="drag-zone"></div>
            </div>
            <div class="machine-col">
                <div class="col-header"><h3>REPASO</h3> <span id="badge-acabados" class="badge">0</span></div>
                <div id="list-acabados" class="drag-zone"></div>
            </div>
        </div>
        <button onclick="location.reload()" style="width:100%; background:none; border:none; color:#444; margin-top:40px; font-size:12px;">CERRAR SESIÓN</button>
    </main>
</div>

<div id="modalPedido" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0">NUEVA ORDEN</h3>
        <label style="display:block; margin-bottom:10px; font-size:12px; color:#666;">CLIENTE</label>
        <input type="text" id="inCli" placeholder="Nombre cliente">
        
        <label style="display:block; margin-bottom:10px; font-size:12px; color:#666;">MÁQUINA</label>
        <select id="inMaq">
            <option value="list-flexo">Flexo</option>
            <option value="list-digital">Digital</option>
        </select>
        
        <label style="display:block; margin-bottom:10px; font-size:12px; color:#666;">METROS</label>
        <input type="number" id="inMet" placeholder="0">
        
        <button class="btn-action" onclick="addPedido()">CREAR PEDIDO</button>
        <button onclick="closeModal()" style="width:100%; background:none; border:none; color:#666; margin-top:20px; cursor:pointer;">Cancelar</button>
    </div>
</div>

<script>
const PASS_MAESTRA = "TrackLabel#";
const USUARIOS = {"Isa":"1234", "Jaume":"1234", "Ivan":"1234", "Anna":"1234", "Toni":"1234"};
let db = JSON.parse(localStorage.getItem('track_db_v2')) || {};
let userActivo = null;

// SEGURIDAD
function unlockWeb() {
    if(document.getElementById('pass-web').value === PASS_MAESTRA) {
        document.getElementById('master-lock').style.display = 'none';
        document.getElementById('login-screen').style.display = 'flex';
    } else { alert("Error contraseña"); }
}

function selectUser(name, el) {
    userActivo = name;
    document.querySelectorAll('.user-item').forEach(i => i.style.borderColor = "#222");
    el.style.borderColor = "var(--orange)";
}

function loginApp() {
    const pin = document.getElementById('user-pin').value;
    if(userActivo && USUARIOS[userActivo] === pin) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('welcome-text').innerText = "Operario: " + userActivo;
        render();
        initSortable();
    } else { alert("PIN incorrecto"); }
}

// LOGICA
function addPedido() {
    const cli = document.getElementById('inCli').value;
    if(!cli) return;
    const id = "ID-" + Date.now();
    db[id] = { cli: cli, maq: document.getElementById('inMaq').value, met: document.getElementById('inMet').value };
    save();
    closeModal();
    render();
}

function render() {
    document.querySelectorAll('.drag-zone').forEach(z => z.innerHTML = "");
    Object.keys(db).forEach(id => {
        const item = db[id];
        const card = document.createElement('div');
        card.className = "job-card";
        card.id = id;
        card.innerHTML = `<strong>${item.cli.toUpperCase()}</strong><small>${item.met} metros</small>`;
        card.onclick = () => { if(confirm("¿Pedido completado?")) { delete db[id]; save(); render(); } };
        document.getElementById(item.maq).appendChild(card);
    });
    actualizarBadges();
}

function initSortable() {
    document.querySelectorAll('.drag-zone').forEach(z => {
        new Sortable(z, { group: 'planta', animation: 150, onEnd: (e) => {
            db[e.item.id].maq = e.to.id;
            save();
            actualizarBadges();
        }});
    });
}

function save() {
    localStorage.setItem('track_db_v2', JSON.stringify(db));
}

function actualizarBadges() {
    document.getElementById('badge-flexo').innerText = document.getElementById('list-flexo').children.length;
    document.getElementById('badge-digital').innerText = document.getElementById('list-digital').children.length;
    document.getElementById('badge-acabados').innerText = document.getElementById('list-acabados').children.length;
}

function openModal() { document.getElementById('modalPedido').style.display = 'block'; document.body.style.overflow = 'hidden'; }
function closeModal() { document.getElementById('modalPedido').style.display = 'none'; document.body.style.overflow = 'auto'; }
</script>

</body>
</html>
