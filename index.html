<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TrackLabel Pro Enterprise | Full System v2.7.5</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-deep: #010204;
            --bg-panel: #0b0e14;
            --bg-surface: #151921;
            --bg-card: #1c212b;
            --accent: #ff7a00;
            --success: #2ea043;
            --warning: #f1e05a;
            --error: #f85149;
            --info: #388bfd;
            --text-main: #e6edf3;
            --text-dim: #8b949e;
            --border: #30363d;
            --radius-xl: 35px;
            --radius-lg: 20px;
        }

        /* --- RESET GENERAL --- */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body, html { 
            background: var(--bg-deep); color: var(--text-main); 
            font-family: 'Inter', sans-serif; margin: 0; padding: 0; 
            height: 100vh; width: 100vw; overflow: hidden;
        }

        /* --- PANTALLA DE BLOQUEO --- */
        .system-lock {
            position: fixed; inset: 0; background: var(--bg-deep); z-index: 99999;
            display: flex; align-items: center; justify-content: center; padding: 30px;
        }
        .lock-container {
            background: var(--bg-panel); border: 1px solid var(--border);
            padding: 60px; border-radius: var(--radius-xl); width: 100%; max-width: 500px;
            text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.6);
        }

        /* --- ESTRUCTURA PRINCIPAL --- */
        .app-layout { display: flex; height: 100vh; width: 100vw; }
        
        .sidebar { 
            width: 320px; background: var(--bg-panel); border-right: 1px solid var(--border); 
            display: flex; flex-direction: column; flex-shrink: 0;
        }
        
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; background: #05070a; }

        .top-nav {
            height: 90px; padding: 0 40px; border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            background: var(--bg-panel);
        }

        /* --- TABLERO KANBAN --- */
        .kanban-view { 
            flex: 1; overflow-x: auto; overflow-y: hidden; padding: 30px; 
            display: flex; gap: 25px; align-items: flex-start;
        }
        
        .lane { 
            background: rgba(11, 14, 20, 0.6); border-radius: 30px; border: 1px solid var(--border); 
            width: 420px; flex-shrink: 0; max-height: 100%; display: flex; flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .lane-header { padding: 25px 30px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .lane-header h3 { margin: 0; font-size: 13px; letter-spacing: 2px; color: var(--text-dim); text-transform: uppercase; font-weight: 800; }
        
        .job-container { 
            padding: 20px; overflow-y: auto; flex: 1; min-height: 200px;
            scrollbar-width: thin; scrollbar-color: var(--border) transparent;
        }

        /* --- TARJETAS (CARDS) --- */
        .job-card {
            background: var(--bg-surface); border-radius: 25px; padding: 22px;
            border-left: 10px solid var(--border); position: relative;
            margin-bottom: 20px; cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
            user-select: none;
        }
        .job-card:hover { background: var(--bg-card); transform: translateY(-2px); }
        .job-card:active { cursor: grabbing; }
        .job-card.sortable-ghost { opacity: 0.1; }
        
        .job-card h4 { margin: 0 0 12px 0; font-size: 20px; font-weight: 900; color: #fff; }

        .card-tags { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; }
        .tag { 
            background: rgba(0,0,0,0.3); padding: 6px 14px; border-radius: 12px; 
            font-size: 11px; border: 1px solid var(--border); color: var(--text-dim);
            font-weight: 600;
        }

        /* ÁREA DEL BOTÓN (ZONA AZUL) */
        .action-area {
            background: rgba(255, 122, 0, 0.03);
            border: 1px dashed var(--border);
            border-radius: 18px;
            padding: 12px;
            margin-top: 10px;
        }
        .btn-direct-action {
            width: 100%; padding: 15px; border-radius: 14px; border: none;
            font-weight: 900; font-size: 12px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            text-transform: uppercase; transition: 0.3s;
        }
        
        /* Estados de botón */
        .btn-st-espera { background: var(--accent); color: #000; }
        .btn-st-prep { background: var(--info); color: #fff; }
        .btn-st-run { background: var(--success); color: #fff; }
        .btn-st-done { background: var(--border); color: var(--text-dim); cursor: default; }

        /* Etiqueta de Operario en Finalizados */
        .op-stamp {
            position: absolute; top: 15px; right: 15px;
            background: var(--success); color: #000;
            padding: 4px 10px; border-radius: 8px; font-size: 10px; font-weight: 900;
        }

        /* --- MODALES --- */
        .modal-mask {
            position: fixed; inset: 0; background: rgba(0,0,0,0.96); z-index: 80000;
            display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(15px);
        }
        .modal-body {
            background: var(--bg-panel); border: 1px solid var(--border); width: 100%;
            max-width: 800px; border-radius: 40px; padding: 45px; max-height: 95vh; overflow-y: auto;
        }

        .hero-clock {
            background: #000; border-radius: 30px; padding: 45px; text-align: center;
            border: 1px solid var(--border); margin: 25px 0; box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
        }
        .clock-val { font-family: 'JetBrains Mono'; font-size: 75px; color: var(--success); letter-spacing: -2px; }

        /* --- FORMULARIOS --- */
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        input, select {
            width: 100%; background: var(--bg-deep); border: 1px solid var(--border);
            color: #fff; padding: 18px; border-radius: 15px; font-size: 15px; transition: 0.3s;
        }
        input:focus { border-color: var(--accent); }
        label { display: block; font-size: 11px; font-weight: 900; color: var(--accent); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }

        .btn-main { padding: 20px; border-radius: 18px; border: none; font-weight: 900; cursor: pointer; transition: 0.3s; text-transform: uppercase; }
        .btn-accent { background: var(--accent); color: #000; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-dim); }

    </style>
</head>
<body>

    <div id="screen-login" class="system-lock">
        <div class="lock-container">
            <i class="fas fa-industry" style="font-size: 60px; color: var(--accent); margin-bottom: 25px;"></i>
            <h1 style="letter-spacing: 5px; font-weight: 900;">TRACKLABEL <span style="color:var(--accent)">PRO</span></h1>
            <p style="color:var(--text-dim); margin-top: -10px; font-size: 12px; font-weight: 700;">ENTERPRISE PRODUCTION CONTROL</p>
            <input type="password" id="pin" placeholder="PIN ACCESO" style="text-align: center; font-size: 28px; margin: 40px 0; letter-spacing: 10px;">
            <button class="btn-main btn-accent" onclick="login()" style="width:100%;">ENTRAR AL TURNO</button>
        </div>
    </div>

    <div id="app" class="app-layout" style="display: none;">
        <aside class="sidebar">
            <div style="padding:40px 30px; border-bottom:1px solid var(--border);">
                <div style="background:var(--bg-surface); padding:20px; border-radius:22px; display:flex; align-items:center; gap:15px; border: 1px solid var(--border);">
                    <div id="op-avatar" style="width:50px; height:50px; background:var(--accent); border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:900; color:#000; font-size:22px;">I</div>
                    <div>
                        <div id="op-name" style="font-weight:900; font-size:18px;">Iván</div>
                        <div style="font-size:10px; color:var(--success); font-weight:800; letter-spacing: 1px;">SISTEMA ONLINE</div>
                    </div>
                </div>
            </div>
            <div style="padding: 20px 30px;">
                <h4 style="font-size: 10px; color: var(--text-dim); text-transform: uppercase;">Actividad Reciente</h4>
            </div>
            <div id="audit-log" style="flex:1; padding:0 30px 30px 30px; overflow-y:auto; font-size:11px; color:var(--text-dim); line-height:2;"></div>
        </aside>

        <main class="main-content">
            <header class="top-nav">
                <div style="position: relative;">
                    <i class="fas fa-search" style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--text-dim);"></i>
                    <input type="text" id="search" placeholder="Buscar por cliente, troquel..." oninput="draw()" style="width:450px; border-radius:50px; padding-left: 50px;">
                </div>
                <button class="btn-main btn-accent" onclick="openEditor()" style="padding: 12px 35px; font-size: 12px;">+ NUEVA ORDEN</button>
            </header>

            <div class="kanban-view">
                <div class="lane">
                    <div class="lane-header"><h3>FLEXOGRAFÍA</h3><span id="c-lane-flexo" class="tag">0</span></div>
                    <div id="lane-flexo" class="job-container"></div>
                </div>
                <div class="lane">
                    <div class="lane-header"><h3>DIGITAL</h3><span id="c-lane-digital" class="tag">0</span></div>
                    <div id="lane-digital" class="job-container"></div>
                </div>
                <div class="lane">
                    <div class="lane-header"><h3>REPASO</h3><span id="c-lane-repaso" class="tag">0</span></div>
                    <div id="lane-repaso" class="job-container"></div>
                </div>
                <div class="lane" style="border-color: var(--success); background: rgba(46, 160, 67, 0.03);">
                    <div class="lane-header" style="border-color: var(--success);">
                        <h3 style="color: var(--success);">FINALIZADOS</h3>
                        <span id="c-lane-done" class="tag" style="background: var(--success); color: #000; border: none;">0</span>
                    </div>
                    <div id="lane-done" class="job-container"></div>
                </div>
            </div>
        </main>
    </div>

    <div id="modal-prod" class="modal-mask">
        <div class="modal-body">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h1 id="p-cli" style="margin:0; font-size:38px; font-weight:900; letter-spacing: -1px;">CLIENTE</h1>
                <div id="p-status-pill" style="padding:10px 20px; border-radius:12px; font-weight:900; font-size:12px; text-transform: uppercase;">ESTADO</div>
            </div>
            <p id="p-detalles" style="color:var(--text-dim); margin-top:15px; font-size: 16px;"></p>
            
            <div class="hero-clock">
                <div id="p-clock" class="clock-val">00:00:00</div>
                <div style="font-size:11px; letter-spacing:5px; color:var(--text-dim); margin-top:15px; font-weight:800;">TIEMPO ACUMULADO EN FASE</div>
            </div>

            <div class="form-row">
                <div><label>Metros Producidos</label><input type="number" id="p-real" style="font-size:35px; font-weight:900; text-align:center; color:var(--success);"></div>
                <div><label>Velocidad Promedio</label><div id="p-speed" style="padding:20px; border-radius:15px; background:var(--bg-deep); text-align:center; font-weight:900; font-size:35px; border: 1px solid var(--border);">0.0</div></div>
            </div>

            <div id="p-actions" style="display:grid; grid-template-columns:1fr 1fr; gap:20px;"></div>
            
            <button class="btn-main btn-outline" onclick="closeModal('modal-prod')" style="width:100%; margin-top:30px;">CERRAR PANEL Y SEGUIR EN TABLERO</button>
        </div>
    </div>

    <div id="modal-editor" class="modal-mask">
        <div class="modal-body">
            <h2 id="ed-title" style="font-weight: 900; font-size: 30px; margin-bottom: 30px;">CONFIGURAR ORDEN</h2>
            <div class="form-row">
                <div style="grid-column: span 2;"><label>Nombre del Cliente</label><input type="text" id="f-cli"></div>
                <div><label>Línea</label>
                    <select id="f-lane">
                        <option value="lane-flexo">FLEXOGRAFÍA</option>
                        <option value="lane-digital">IMPRESIÓN DIGITAL</option>
                        <option value="lane-repaso">REPASO / ACABADO</option>
                    </select>
                </div>
                <div><label>Metros Objetivo</label><input type="number" id="f-met"></div>
                <div><label>Referencia Troquel</label><input type="text" id="f-tro"></div>
                <div><label>Material / Soporte</label><input type="text" id="f-mat"></div>
            </div>
            <div style="display:flex; gap:20px; margin-top:10px;">
                <button class="btn-main btn-accent" onclick="saveJob()" style="flex:2;">GUARDAR EN PRODUCCIÓN</button>
                <button class="btn-main btn-outline" id="btn-del" onclick="deleteJob()" style="flex:1; border-color: var(--error); color: var(--error); display:none;">ELIMINAR</button>
                <button class="btn-main btn-outline" onclick="closeModal('modal-editor')" style="flex:1;">CANCELAR</button>
            </div>
        </div>
    </div>

    <script>
        /**
         * LÓGICA CORE TRACKLABEL ENTERPRISE
         */
        
        // Base de Datos (LocalStorage)
        let JOBS = JSON.parse(localStorage.getItem('tl_jobs_v275')) || {};
        let DONE_LIST = JSON.parse(localStorage.getItem('tl_done_v275')) || [];
        let activeId = null;
        let clockTimer = null;
        let currentUser = "Iván"; // Por defecto, se puede cambiar en un sistema multiusuario

        // Autenticación simple
        function login() {
            const pin = document.getElementById('pin').value;
            if(pin === "1234") {
                document.getElementById('screen-login').style.display = 'none';
                document.getElementById('app').style.display = 'flex';
                initSystem();
            } else {
                alert("PIN INCORRECTO");
            }
        }

        // Inicialización
        function initSystem() {
            draw();
            initDragAndDrop();
            addLog("Sistema iniciado por " + currentUser);
        }

        // Dibujar Tablero
        function draw() {
            const query = document.getElementById('search').value.toLowerCase();
            const columns = ['lane-flexo', 'lane-digital', 'lane-repaso', 'lane-done'];
            columns.forEach(id => document.getElementById(id).innerHTML = "");

            // 1. Dibujar Trabajos Activos
            Object.keys(JOBS).forEach(id => {
                const j = JOBS[id];
                if(j.cli.toLowerCase().includes(query)) {
                    const card = document.createElement('div');
                    card.className = "job-card";
                    card.setAttribute('data-id', id);
                    card.style.borderLeftColor = getStatusColor(j.status);

                    let actionHtml = "";
                    if(j.status === "ESPERA") {
                        actionHtml = `<button class="btn-direct-action btn-st-espera" onclick="event.stopPropagation(); changePhase('${id}', 'PREPARACIÓN')"><i class="fas fa-play"></i> INICIAR PREPARACIÓN</button>`;
                    } else if(j.status === "PREPARACIÓN") {
                        actionHtml = `<button class="btn-direct-action btn-st-prep" onclick="event.stopPropagation(); changePhase('${id}', 'TIRAJE')"><i class="fas fa-rocket"></i> PASAR A TIRAJE</button>`;
                    } else {
                        actionHtml = `<button class="btn-direct-action btn-st-run" onclick="event.stopPropagation(); openProduction('${id}')"><i class="fas fa-cog fa-spin"></i> GESTIONAR PRODUCCIÓN</button>`;
                    }

                    card.innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h4 onclick="event.stopPropagation(); openEditor('${id}')">${j.cli.toUpperCase()}</h4>
                            <span class="tag" style="background:rgba(0,0,0,0.4)">${j.status}</span>
                        </div>
                        <div class="card-tags">
                            <span class="tag"><i class="fas fa-ruler"></i> ${j.met}m</span>
                            <span class="tag"><i class="fas fa-hashtag"></i> ${j.tro}</span>
                            <span class="tag"><i class="fas fa-scroll"></i> ${j.mat}</span>
                        </div>
                        <div class="action-area">${actionHtml}</div>
                    `;
                    document.getElementById(j.lane).appendChild(card);
                }
            });

            // 2. Dibujar Historial de Finalizados (Tu petición específica)
            DONE_LIST.forEach(j => {
                const card = document.createElement('div');
                card.className = "job-card";
                card.style.borderLeftColor = 'var(--success)';
                card.style.opacity = "0.8";
                card.innerHTML = `
                    <div class="op-stamp">HECHO POR: ${j.operator}</div>
                    <h4>${j.cli.toUpperCase()}</h4>
                    <div class="card-tags">
                        <span class="tag"><i class="fas fa-check-circle"></i> ${j.realMet}m PRODUCIDOS</span>
                        <span class="tag"><i class="fas fa-clock"></i> TIEMPO: ${j.timeResult}</span>
                    </div>
                `;
                document.getElementById('lane-done').appendChild(card);
            });

            updateCounters();
        }

        // --- GESTIÓN DE TIEMPOS Y FASES ---
        function changePhase(id, newStatus) {
            const j = JOBS[id];
            const now = Date.now();

            // Guardar progreso anterior
            if(j.startTime) {
                j.totalMs = (j.totalMs || 0) + (now - j.startTime);
            }

            j.status = newStatus;
            j.startTime = now;
            j.operator = currentUser; // Registrar quién inició la fase
            
            saveData();
            draw();
            openProduction(id);
            addLog(`${j.cli} cambió a ${newStatus}`);
        }

        function openProduction(id) {
            activeId = id;
            const j = JOBS[id];
            
            document.getElementById('p-cli').innerText = j.cli;
            document.getElementById('p-detalles').innerText = `${j.mat} | Troquel: ${j.tro} | Objetivo: ${j.met}m`;
            
            const pill = document.getElementById('p-status-pill');
            pill.innerText = j.status;
            pill.style.background = getStatusColor(j.status);
            pill.style.color = (j.status === 'TIRAJE') ? '#fff' : '#000';
            
            document.getElementById('p-real').value = j.realMet || 0;

            const actionContainer = document.getElementById('p-actions');
            actionContainer.innerHTML = "";

            if(j.status === "PREPARACIÓN") {
                actionContainer.innerHTML = `<button class="btn-main btn-accent" onclick="changePhase('${id}', 'TIRAJE')" style="grid-column: span 2; background:var(--info); color:#fff;">FINALIZAR PREPARACIÓN Y TIRAR</button>`;
            } else if(j.status === "TIRAJE") {
                actionContainer.innerHTML = `
                    <button class="btn-main" onclick="changePhase('${id}', 'PARADA')" style="background:var(--error); color:#fff;">NOTIFICAR PARADA</button>
                    <button class="btn-main" onclick="finishOrder('${id}')" style="background:var(--success); color:#fff;">FINALIZAR PEDIDO COMPLETADO</button>
                `;
            } else if(j.status === "PARADA") {
                actionContainer.innerHTML = `<button class="btn-main" onclick="changePhase('${id}', 'TIRAJE')" style="grid-column: span 2; background:var(--info); color:#fff;">REANUDAR PRODUCCIÓN</button>`;
            }

            document.getElementById('modal-prod').style.display = 'flex';
            
            if(clockTimer) clearInterval(clockTimer);
            clockTimer = setInterval(runClock, 1000);
        }

        function runClock() {
            const j = JOBS[activeId];
            if(!j || j.status === "PARADA" || !j.startTime) return;

            const elapsed = (Date.now() - j.startTime) + (j.totalMs || 0);
            document.getElementById('p-clock').innerText = formatMs(elapsed);
            
            // Metraje y velocidad
            const real = document.getElementById('p-real').value || 0;
            const mins = elapsed / 60000;
            document.getElementById('p-speed').innerText = mins > 0 ? (real / mins).toFixed(1) : "0.0";
            j.realMet = real;
        }

        function finishOrder(id) {
            if(confirm("¿Deseas finalizar el pedido? Se moverá al historial con tu nombre.")) {
                const j = JOBS[id];
                const total = (Date.now() - j.startTime) + (j.totalMs || 0);
                
                // Crear Registro Histórico
                const historicalRecord = {
                    cli: j.cli,
                    operator: currentUser, // Tu nombre aquí
                    realMet: document.getElementById('p-real').value,
                    timeResult: formatMs(total),
                    timestamp: new Date().toLocaleString()
                };

                DONE_LIST.unshift(historicalRecord); // Añadir al inicio de la lista de finalizados
                if(DONE_LIST.length > 30) DONE_LIST.pop(); // Limite de 30 registros

                delete JOBS[id];
                saveData();
                closeModal('modal-prod');
                draw();
                addLog(`Pedido ${historicalRecord.cli} FINALIZADO por ${currentUser}`);
            }
        }

        // --- ARRASTRE ---
        function initDragAndDrop() {
            const containers = ['lane-flexo', 'lane-digital', 'lane-repaso'];
            containers.forEach(cid => {
                new Sortable(document.getElementById(cid), {
                    group: 'production-workflow',
                    animation: 250,
                    ghostClass: 'sortable-ghost',
                    handle: '.job-card',
                    onEnd: function(evt) {
                        const id = evt.item.getAttribute('data-id');
                        const newLane = evt.to.id;
                        if(JOBS[id]) {
                            JOBS[id].lane = newLane;
                            saveData();
                            updateCounters();
                        }
                    }
                });
            });
        }

        // --- CRUD DE TRABAJOS ---
        function saveJob() {
            const id = activeId || "OT-" + Date.now();
            JOBS[id] = {
                cli: document.getElementById('f-cli').value,
                lane: document.getElementById('f-lane').value,
                met: document.getElementById('f-met').value,
                tro: document.getElementById('f-tro').value,
                mat: document.getElementById('f-mat').value,
                status: JOBS[id]?.status || "ESPERA",
                totalMs: JOBS[id]?.totalMs || 0,
                realMet: JOBS[id]?.realMet || 0,
                startTime: JOBS[id]?.startTime || null
            };
            saveData();
            closeModal('modal-editor');
            draw();
            addLog("Orden Guardada: " + JOBS[id].cli);
        }

        function openEditor(id = null) {
            activeId = id;
            const delBtn = document.getElementById('btn-del');
            if(id) {
                const j = JOBS[id];
                document.getElementById('f-cli').value = j.cli;
                document.getElementById('f-met').value = j.met;
                document.getElementById('f-tro').value = j.tro;
                document.getElementById('f-mat').value = j.mat;
                document.getElementById('f-lane').value = j.lane;
                delBtn.style.display = "block";
                document.getElementById('ed-title').innerText = "EDITAR ORDEN";
            } else {
                ['f-cli','f-met','f-tro','f-mat'].forEach(el => document.getElementById(el).value = "");
                delBtn.style.display = "none";
                document.getElementById('ed-title').innerText = "NUEVA ORDEN";
            }
            document.getElementById('modal-editor').style.display = 'flex';
        }

        function deleteJob() {
            if(confirm("¿Eliminar definitivamente este trabajo del tablero?")) {
                delete JOBS[activeId];
                saveData();
                closeModal('modal-editor');
                draw();
            }
        }

        // --- UTILIDADES ---
        function saveData() { 
            localStorage.setItem('tl_jobs_v275', JSON.stringify(JOBS)); 
            localStorage.setItem('tl_done_v275', JSON.stringify(DONE_LIST));
        }

        function formatMs(ms) {
            let s = Math.floor(ms/1000), m = Math.floor(s/60), h = Math.floor(m/60);
            return `${h.toString().padStart(2,'0')}:${(m%60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;
        }

        function getStatusColor(s) {
            if(s === 'TIRAJE') return 'var(--success)';
            if(s === 'PREPARACIÓN') return 'var(--info)';
            if(s === 'PARADA') return 'var(--error)';
            return 'var(--border)';
        }

        function closeModal(m) { 
            document.getElementById(m).style.display='none'; 
            if(m === 'modal-prod') clearInterval(clockTimer);
        }

        function addLog(msg) {
            const log = document.getElementById('audit-log');
            const time = new Date().toLocaleTimeString();
            log.innerHTML = `<div style="margin-bottom:8px;"><span style="color:var(--accent); font-weight:800;">[${time}]</span> ${msg}</div>` + log.innerHTML;
        }

        function updateCounters() {
            ['lane-flexo','lane-digital','lane-repaso','lane-done'].forEach(id => {
                document.getElementById('c-'+id).innerText = document.getElementById(id).children.length;
            });
        }
    </script>
</body>
</html>
